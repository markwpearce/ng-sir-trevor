!function(){"use strict";angular.module("SirTrevor",[]).provider("SirTrevor",function(){this.$get=function(){return window.SirTrevor},this.Blocks=window.SirTrevor.Blocks,this.Block=window.SirTrevor.Block,this.Formatters=window.SirTrevor.Formatters,this.Formatter=window.SirTrevor.Formatter,this.Locales=window.SirTrevor.Locales,this.DEFAULTS=window.SirTrevor.DEFAULTS}).provider("SirTrevorOptions",function(){var t={blockTypes:["Text"],transform:{get:function(t){return{type:t.blockStorage.type,data:t.blockStorage.data}},set:function(t){return{type:t.type,data:t.data}}}};this.$get=function(){return t},this.$extend=function(r){angular.extend(t,r)},this.$set=function(r){t=r}}).directive("ngSirTrevor",["SirTrevor","SirTrevorOptions","$timeout",function(t,r,o){var e={template:function(t){var r='<textarea class="sir-trevor" name="content"></textarea>';return t.parent("form").length||(r="<form>"+r+"</form>"),r},scope:{editor:"=stEditor",params:"=stParams",data:"=stData",alwaysCheckValidation:"=?stAlwaysValidate"},controller:["$scope",function(t){t.data||(t.data=[])}],link:function(e,n){var i=angular.copy(r);angular.extend(i,e.params),i.el=$(n.find("textarea")),e.editor=new t.Editor(i);var a=function(){o(function(){e.data=e.editor.get(e.alwaysCheckValidation)})};e.editor.get=function(t){var r=[];return e.editor.block_manager.blocks.sort(function(t,r){return t.$el.index()-r.$el.index()}),angular.forEach(e.editor.block_manager.blocks,function(o){e.editor.validateAndSaveBlock(o,t),r.push(i.transform.get(o))}),r},e.editor.set=function(t){var r;angular.forEach(t,function(t){r=i.transform.set(t),e.editor.block_manager.createBlock(r.type,r.data)})},e.editor.clear=function(){angular.forEach(e.editor.block_manager.blocks,function(t){e.editor.block_manager.removeBlock(t.blockID)})},e.editor.$form.keypress(function(){e.$digest()}),e.editor.$form.click(function(){e.$digest()}),e.editor.$form.mousedown(function(){e.$digest()}),e.editor.$form.mouseup(function(){e.$digest()}),e.editor.$form.bind("cut copy paste",function(){o(function(){e.$digest()})}),$(".st-format-bar").click(function(){e.$digest()}),t.EventBus.on("block:create:new",function(){e.$digest()}),t.EventBus.on("block:create:existing",function(){e.$digest()}),t.EventBus.on("block:remove",function(){e.$digest()}),t.EventBus.on("block:reorder:dropped",function(){e.$digest()}),t.EventBus.on("formatter:hide",function(){e.$digest()}),t.EventBus.on("formatter:position",function(){e.$digest()}),e.$watch(function(){return e.editor.$form.html()},function(){a()}),angular.isArray(e.data)&&e.editor.set(e.data),a()}};return e}])}();